
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Training Plan — JS Clean (Reps + e1RM)</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f1115">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-512.png">
  <style>
    :root{ --bg:#0f1115; --card:#171a21; --text:#e8eaf0; --muted:#a8b3c3; --accent:#5ec4ff; --border:#222633; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(15,17,21,.95),rgba(15,17,21,.75));backdrop-filter:saturate(150%) blur(8px);padding:12px 14px;border-bottom:1px solid var(--border)}
    h1{font-size:18px;margin:0}
    .sub{color:var(--muted);font-size:12px;margin-top:4px}
    .tabs{display:flex;gap:6px;margin:10px 14px 0 14px;overflow-x:auto;padding-bottom:6px}
    .tab{flex:0 0 auto;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--text);font-weight:600;font-size:13px;white-space:nowrap}
    .tab.active{outline:2px solid var(--accent)}
    main{padding:12px 14px 90px 14px}
    section{display:none}
    section.active{display:block}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px}
    label{display:inline-flex;align-items:center;gap:6px;margin:6px 8px 6px 0;font-size:14px;color:var(--muted)}
    input[type="number"], select{padding:8px;border-radius:10px;border:1px solid var(--border);background:#0b0d12;color:var(--text)}
    input[type="number"]{width:110px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .btn{appearance:none;border:none;border-radius:10px;background:var(--accent);color:#001721;font-weight:700;padding:10px 12px;font-size:14px}
    .btn.secondary{background:#263244;color:var(--text);border:1px solid var(--border)}
    .switch{display:inline-flex;align-items:center;gap:8px;cursor:pointer;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#0b0d12}
    .switch input{appearance:none;width:16px;height:16px;border-radius:4px;border:1px solid var(--border);margin:0;background:#12151c}
    .switch input:checked{background:var(--accent)}
    table{width:100%;border-collapse:collapse;font-size:12px;margin-top:8px}
    th,td{border-bottom:1px solid var(--border);padding:8px;text-align:center}
    th{position:sticky;top:0;background:#12151c;z-index:1}
    .small{font-size:12px;color:var(--muted)}
    ul{margin:0 0 0 18px}
    li{margin:6px 0}
    .footer{position:fixed;bottom:0;left:0;right:0;background:linear-gradient(0deg,rgba(15,17,21,.95),rgba(15,17,21,.6));backdrop-filter:blur(8px);border-top:1px solid var(--border);padding:10px 14px;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .pill{border:1px solid var(--border);background:#0b0d12;border-radius:12px;padding:6px 10px;color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
    a.exlink{ color:#ff9800; text-decoration:none; border-bottom:1px dotted #ff9800 }
    a.exlink:active, a.exlink:focus, a.exlink:hover{ text-decoration:underline }
    .mini{font-size:11px;color:var(--muted)}
    .inpwrap{display:flex;gap:6px;align-items:center}
    .inpwrap input[type="number"]{width:92px}
  </style>
</head>
<body>
  <header>
    <h1>15‑Week Training Plan — JS Clean</h1>
    <div class="sub">Per‑set logging (weight + reps) • e1RM estimates</div>
  </header>

  <div class="tabs" id="tabs">
    <button class="tab active" data-tab="daily">Daily</button>
    <button class="tab" data-tab="weekly">Weekly</button>
    <button class="tab" data-tab="lifts">Lifts</button>
    <button class="tab" data-tab="about">About</button>
  </div>

  <main>
    <section id="daily" class="active">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            <h3 style="margin:0 0 8px 0">Daily Planner</h3>
            <div class="small">Log the **actual** weight and reps for each set. Accessories: log top set (weight + reps).</div>
          </div>
          <div class="row" style="gap:6px">
            <label class="switch"><input id="seasonedDaily" type="checkbox">Seasoned</label>
            <label class="switch"><input id="lbDaily" type="checkbox">lb</label>
          </div>
        </div>
        <div class="row" style="gap:10px;margin-top:8px">
          <label>Week <select id="weekSelect"></select></label>
          <label>Day
            <select id="daySelect">
              <option>Lower A</option>
              <option>Upper A</option>
              <option>Lower B</option>
              <option>Upper B</option>
            </select>
          </label>
        </div>
      </div>
      <div class="card" id="dailyMeta"></div>
      <div class="card" id="dailyOut"></div>
    </section>

    <section id="weekly">
      <div class="card">
        <h3>Weekly Overview</h3>
        <div class="row" style="gap:10px">
          <label>Week <select id="weekSelectWeekly"></select></label>
          <label class="switch"><input id="seasonedWeekly" type="checkbox">Seasoned</label>
        </div>
        <div class="small" id="weeklyMeta"></div>
      </div>
      <div class="card" id="weeklyOut"></div>
    </section>

    <section id="lifts">
      <div class="card">
        <div class="row">
          <label>Squat 1RM <input id="sq" type="number" inputmode="decimal" placeholder="kg"></label>
          <label>Bench 1RM <input id="bp" type="number" inputmode="decimal" placeholder="kg"></label>
          <label>Deadlift 1RM <input id="dl" type="number" inputmode="decimal" placeholder="kg"></label>
          <label>Clean 1RM <input id="cln" type="number" inputmode="decimal" placeholder="kg"></label>
        </div>
        <div class="row" style="margin-top:6px">
          <label class="switch"><input id="useTM" type="checkbox">Use Training Max (90%)</label>
          <label class="switch"><input id="lb" type="checkbox">Show in lb</label>
          <button class="btn" id="saveBtn">Save</button>
          <span class="pill" id="status">Unsaved</span>
        </div>
        <div class="small" style="margin-top:6px">DB Bench is the main press; %s anchored to barbell Bench 1RM for consistency.</div>
      </div>
      <div class="card">
        <strong>Session Maxes (All Movements)</strong>
        <div class="small">Shows your heaviest **logged set** by movement with reps and an estimated 1RM (Epley: <span class="mono">e1RM = w × (1 + r/30)</span>).</div>
        <div id="maxesWrap" style="margin-top:8px"></div>
      </div>
    </section>

    <section id="about">
      <div class="card">
        <h3>Programming Philosophy</h3>
        <p>This block blends hypertrophy and athleticism. Strength work on Squat/Deadlift/Clean and DB Bench (anchored to barbell BP 1RM) with tailored warm ups. Lower days lead with jumps/throws/bounds; upper days feature med‑ball work and gymnastics (ring dips, muscle‑ups, handstand push‑ups). Weeks 5 & 10 deload, Week 15 test.</p>
      </div>
    </section>
  </main>

  <div class="footer">
    <span class="pill">Blocks: Base • Intensify • Peak • Test</span>
    <button class="btn" id="quickCalc">Quick Calc</button>
  </div>

  <script>
    // ---------- Helpers ----------
    function roundLoad(x, toLb){ const step = toLb ? 5 : 2.5; return Math.round(x/step)*step; }
    function kgToLb(x){ return x*2.20462; }
    function lbToKg(x){ return x/2.20462; }
    function fmtKgLb(kg, toLb){ return toLb ? Math.round(kgToLb(kg))+' lb' : kg.toFixed(1)+' kg'; }
    function blockForWeek(w){ if(w>=1&&w<=4) return 1; if(w===5) return 'deload5'; if(w>=6&&w<=9) return 2; if(w===10) return 'deload10'; if(w>=11&&w<=14) return 3; if(w===15) return 'test15'; }
    function epley(weightKg, reps){ if(!reps || reps<=1) return weightKg; return weightKg*(1+reps/30); }

    // ---------- Tutorials (YouTube search links) ----------
    function yt(name){ const q = encodeURIComponent(name+' tutorial technique'); return 'https://www.youtube.com/results?search_query='+q; }
    function linkify(text){
      const keys = ['Back Squat','Front Squat','Deadlift','Romanian Deadlift','RDL','Dumbbell Bench Press','Incline DB Bench','Overhead Press','Ring Dips','Muscle-ups','Handstand Push-ups','Pull-up','Box Jumps','Countermovement Jumps','Pogo Jumps','Bounds','Med-Ball Chest Pass','Med-Ball Scoop Toss','Farmer’s Carry','Suitcase Carry','Pallof Press','Ab Rollout','Calf Raise','Clean','Weighted Pull‑ups','Facepulls','Rear Delt Rows','DB Biceps Curls','Bulgarian Split Squat','Hack Squat','Hamstring Curl'];
      let out = text;
      keys.forEach(k=>{
        const re = new RegExp(k.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'), 'gi');
        out = out.replace(re, m=>`<a class="exlink" href="${yt(k)}" target="_blank" rel="noopener">${m}</a>`);
      });
      return out;
    }
    function list(items){ return '<ul>'+items.map(x=>`<li>${linkify(x)}</li>`).join('')+'</ul>'; }

    // ---------- Plan Data ----------
    const plan = {
      SQ:[
        {w:1,s:"5×8 @65%",p:[65]},{w:2,s:"5×8 @67.5%",p:[67.5]},{w:3,s:"4×8 @70%",p:[70]},{w:4,s:"4×8 @72.5%",p:[72.5]},
        {w:5,s:"3×5 @60% + 2×1 @80%",p:[60,80]},
        {w:6,s:"5×5 @75%",p:[75]},{w:7,s:"5×4 @80%",p:[80]},{w:8,s:"6×3 @82.5%",p:[82.5]},{w:9,s:"5×3 @85%",p:[85]},
        {w:10,s:"3×3 @65% + AMRAP @70%",p:[65,70]},
        {w:11,s:"5×3 @85%",p:[85]},{w:12,s:"6×2 @87.5%",p:[87.5]},{w:13,s:"5×2 @90%",p:[90]},{w:14,s:"4×1–2 @92.5%",p:[92.5]},
        {w:15,s:"Test 1RM",p:[]}
      ],
      BP:[
        {w:1,s:"DB Bench 5×8 @65% (of BP 1RM)",p:[65]},{w:2,s:"DB Bench 5×8 @67.5%",p:[67.5]},{w:3,s:"DB Bench 4×8 @70%",p:[70]},{w:4,s:"DB Bench 4×8 @72.5%",p:[72.5]},
        {w:5,s:"DB Bench 3×5 @60% + 2×1 @80%",p:[60,80]},
        {w:6,s:"DB Bench 5×5 @75%",p:[75]},{w:7,s:"DB Bench 5×4 @80%",p:[80]},{w:8,s:"DB Bench 6×3 @82.5%",p:[82.5]},{w:9,s:"DB Bench 5×3 @85%",p:[85]},
        {w:10,s:"DB Bench 3×3 @65% + AMRAP @70%",p:[65,70]},
        {w:11,s:"DB Bench 5×3 @85%",p:[85]},{w:12,s:"DB Bench 6×2 @87.5%",p:[87.5]},{w:13,s:"DB Bench 5×2 @90%",p:[90]},{w:14,s:"DB Bench 4×1–2 @92.5%",p:[92.5]},
        {w:15,s:"Test 1RM (DB Bench anchored to BP 1RM)",p:[]}
      ],
      DL:[
        {w:1,s:"4×6 @70%",p:[70]},{w:2,s:"4×6 @72.5%",p:[72.5]},{w:3,s:"5×5 @75%",p:[75]},{w:4,s:"4×5 @77.5%",p:[77.5]},
        {w:5,s:"3×3 @60–65% + 2×1 @80%",p:[62.5,80]},
        {w:6,s:"5×4 @77.5%",p:[77.5]},{w:7,s:"6×3 @80%",p:[80]},{w:8,s:"5×3 @82.5%",p:[82.5]},{w:9,s:"4×3 @85%",p:[85]},
        {w:10,s:"3×2 @65% + AMRAP @70%",p:[65,70]},
        {w:11,s:"5×2–3 @85%",p:[85]},{w:12,s:"5×2 @87.5%",p:[87.5]},{w:13,s:"4×2 @90%",p:[90]},{w:14,s:"3×1–2 @92.5%",p:[92.5]},
        {w:15,s:"Test 1RM",p:[]}
      ],
      CLN:[
        {w:1,s:"5×3 @60%",p:[60]},{w:2,s:"5×3 @65%",p:[65]},{w:3,s:"6×2 @70%",p:[70]},{w:4,s:"6×2 @72.5%",p:[72.5]},
        {w:5,s:"3×2 @60–65%",p:[62.5]},
        {w:6,s:"5×2 @75%",p:[75]},{w:7,s:"6×2 @77.5%",p:[77.5]},{w:8,s:"5×2 @80%",p:[80]},{w:9,s:"4×2 @82.5%",p:[82.5]},
        {w:10,s:"3×2 @65% + AMRAP technique @70%",p:[65,70]},
        {w:11,s:"4×2 @85%",p:[85]},{w:12,s:"5×1–2 @87.5%",p:[87.5]},{w:13,s:"4×1–2 @90%",p:[90]},{w:14,s:"3×1 @92.5%",p:[92.5]},
        {w:15,s:"Test 1RM Clean",p:[]}
      ]
    };

    // ---------- Storage (kg + reps) ----------
    function storeGet(){ try{ return JSON.parse(localStorage.getItem('sessionLoads')||'{}'); }catch(e){ return {}; } }
    function storeSet(obj){ localStorage.setItem('sessionLoads', JSON.stringify(obj)); }
    function keyFor(w, day, lift, section, idx){ return `W${w}|${day}|${lift}|${section}|${idx}`; }
    function accKey(w, day, name){ return `ACC|W${w}|${day}|${name}`; }
    function dailyToLb(){ return document.getElementById('lbDaily').checked || document.getElementById('lb').checked; }

    function saveSetPair(w, day, lift, section, idx){
      const wt = document.getElementById(`wt_${w}_${day}_${lift}_${section}_${idx}`).value;
      const rp = document.getElementById(`rp_${w}_${day}_${lift}_${section}_${idx}`).value;
      const toLb = dailyToLb();
      const store = storeGet();
      const k = keyFor(w, day, lift, section, idx);
      if((wt===''||wt==null) && (rp===''||rp==null)){
        delete store[k];
      } else {
        let kg = Number(wt||0);
        if(toLb) kg = lbToKg(kg);
        store[k] = {kg: kg, reps: (rp===''? null : Number(rp))};
      }
      storeSet(store); buildSessionMaxes();
    }
    function getSetPairDisplay(w, day, lift, section, idx){
      const toLb = dailyToLb();
      const store = storeGet();
      const k = keyFor(w, day, lift, section, idx);
      let rec = store[k];
      if(rec==null) return {wt:'', rp:''};
      if(typeof rec === 'number'){ // migrate old value
        rec = {kg: rec, reps: ''};
      }
      const wt = toLb ? Math.round(kgToLb(rec.kg||0)) : Number(rec.kg||0).toFixed(1);
      const rp = (rec.reps==null ? '' : String(rec.reps));
      return {wt, rp};
    }
    function saveAccessoryPair(w, day, name){
      const wt = document.getElementById(`aw_${w}_${day}_${name}`).value;
      const rp = document.getElementById(`ar_${w}_${day}_${name}`).value;
      const toLb = dailyToLb();
      const store = storeGet();
      const k = accKey(w, day, name);
      if((wt===''||wt==null) && (rp===''||rp==null)){
        delete store[k];
      } else {
        let kg = Number(wt||0);
        if(toLb) kg = lbToKg(kg);
        store[k] = {kg: kg, reps: (rp===''? null : Number(rp))};
      }
      storeSet(store); buildSessionMaxes();
    }
    function getAccessoryPairDisplay(w, day, name){
      const toLb = dailyToLb();
      const store = storeGet();
      let rec = store[accKey(w, day, name)];
      if(rec==null) return {wt:'', rp:''};
      if(typeof rec === 'number'){ rec = {kg: rec, reps: ''}; }
      const wt = toLb ? Math.round(kgToLb(rec.kg||0)) : Number(rec.kg||0).toFixed(1);
      const rp = (rec.reps==null ? '' : String(rec.reps));
      return {wt, rp};
    }

    // ---------- Max table (by heaviest weight) ----------
    function computeHeaviestSets(){
      const s = storeGet(), best = {};
      function consider(name, whereKey, kg, reps){
        const cur = best[name];
        if(!cur || kg > cur.kg || (kg===cur.kg && (reps||0) > (cur.reps||0))){
          best[name] = {kg, reps, where: whereKey};
        }
      }
      Object.entries(s).forEach(([k,v])=>{
        let name;
        let rec = v;
        if(typeof rec === 'number'){ rec = {kg: rec, reps: null}; }
        if(k.startsWith('ACC|')){ name = k.split('|').slice(3).join('|'); }
        else{
          const lift = k.split('|')[2];
          name = (lift==='SQ'?'Back Squat': lift==='BP'?'Dumbbell Bench Press': lift==='DL'?'Deadlift': lift==='CLN'?'Clean': lift);
        }
        consider(name, k, rec.kg||0, rec.reps);
      });
      return best;
    }
    function parseWhere(k){
      if(k.startsWith('ACC|')){ const p=k.split('|'); return {week:p[1].replace('W',''), day:p[2]}; }
      const p=k.split('|'); return {week:p[0].replace('W',''), day:p[1]};
    }
    function buildSessionMaxes(){
      const toLb = document.getElementById('lb').checked;
      const best = computeHeaviestSets();
      const rows = Object.entries(best).map(([name,info])=>{
        const w = parseWhere(info.where);
        const wtDisp = fmtKgLb(info.kg, toLb);
        const repsDisp = (info.reps!=null && info.reps!=='') ? ` × ${info.reps}` : '';
        const e1 = epley(info.kg, Number(info.reps||1));
        const e1Disp = fmtKgLb(e1, toLb);
        return `<tr><td>${name}</td><td>${wtDisp}${repsDisp}</td><td>${e1Disp}</td><td>W${w.week} — ${w.day}</td></tr>`;
      });
      document.getElementById('maxesWrap').innerHTML = rows.length? `<table><thead><tr><th>Movement</th><th>Top Set</th><th>e1RM</th><th>When</th></tr></thead><tbody>${rows.join('')}</tbody></table>` : '<div class="small">No logged sets yet — enter weights & reps in Daily view to populate this table.</div>';
    }

    // ---------- Warmups & rendering ----------
    function warmupsFor(liftKey, targetPct){
      const t = targetPct || 60;
      if(liftKey==='SQ'){
        if(t<=65) return [{pct:40,reps:5},{pct:55,reps:3}];
        if(t<=75) return [{pct:40,reps:5},{pct:55,reps:3},{pct:65,reps:2}];
        if(t<=85) return [{pct:40,reps:5},{pct:55,reps:3},{pct:65,reps:2},{pct:75,reps:1}];
        return [{pct:40,reps:5},{pct:55,reps:3},{pct:65,reps:2},{pct:75,reps:1},{pct:85,reps:1}];
      }
      if(liftKey==='BP'){
        if(t<=65) return [{pct:40,reps:8},{pct:50,reps:5}];
        if(t<=75) return [{pct:40,reps:8},{pct:50,reps:5},{pct:60,reps:3}];
        if(t<=85) return [{pct:40,reps:8},{pct:50,reps:5},{pct:60,reps:3},{pct:70,reps:1}];
        return [{pct:40,reps:8},{pct:50,reps:5},{pct:60,reps:3},{pct:70,reps:1},{pct:80,reps:1}];
      }
      if(liftKey==='DL'){
        if(t<=65) return [{pct:45,reps:5},{pct:60,reps:3}];
        if(t<=75) return [{pct:45,reps:5},{pct:60,reps:3},{pct:70,reps:1}];
        if(t<=85) return [{pct:45,reps:5},{pct:60,reps:3},{pct:70,reps:1},{pct:80,reps:1}];
        return [{pct:45,reps:5},{pct:60,reps:3},{pct:70,reps:1},{pct:80,reps:1},{pct:85,reps:1}];
      }
      if(liftKey==='CLN'){
        if(t<=65) return [{pct:40,reps:3},{pct:50,reps:2},{pct:60,reps:2}];
        if(t<=75) return [{pct:40,reps:3},{pct:50,reps:2},{pct:60,reps:2},{pct:70,reps:1}];
        if(t<=85) return [{pct:40,reps:3},{pct:50,reps:2},{pct:60,reps:2},{pct:70,reps:1},{pct:80,reps:1}];
        return [{pct:40,reps:3},{pct:50,reps:2},{pct:60,reps:2},{pct:70,reps:1},{pct:80,reps:1},{pct:85,reps:1}];
      }
      return [{pct:40,reps:5},{pct:55,reps:3}];
    }

    function currentDay(){ return document.getElementById('daySelect').value; }

    function renderDaily(){
      const w = parseInt(document.getElementById('weekSelect').value);
      const day = currentDay();
      const block = blockForWeek(w);
      const toLb = document.getElementById('lbDaily').checked || document.getElementById('lb').checked;

      let sq = parseFloat(document.getElementById('sq').value||0);
      let bp = parseFloat(document.getElementById('bp').value||0);
      let dl = parseFloat(document.getElementById('dl').value||0);
      let cln= parseFloat(document.getElementById('cln').value||0);
      const useTM = document.getElementById('useTM').checked;
      if(useTM){ sq*=0.9; bp*=0.9; dl*=0.9; cln*=0.9; }
      const oneRMs = {SQ:sq, BP:bp, DL:dl, CLN:cln};

      const blurb = block==='deload5' ? 'Deload Week — reduce accessory volume ~40–50%.' :
                     block==='deload10'? 'Deload + AMRAPs @70% to estimate e1RM.' :
                     block==='test15' ? 'Testing Week — spread lifts/tests; keep volume minimal.' :
                     (block===1?'Block 1: Base & Hypertrophy': block===2?'Block 2: Intensification':'Block 3: Peak Power/Strength');
      document.getElementById('dailyMeta').innerHTML = `<b>Week ${w}</b> — ${day}<br><span class="small">${blurb}</span>`;

      const out = document.getElementById('dailyOut');
      out.innerHTML = '';

      function warmWorkBlocks(liftCode){
        const item = plan[liftCode][w-1];
        const target = (item.p && item.p.length ? item.p[0] : 60);
        const warms = warmupsFor(liftCode, target);
        // Warm-ups
        let warm = '<h5>Warm-up</h5><ul>';
        warms.forEach((wu,i)=>{
          const kg = roundLoad((oneRMs[liftCode]||0)*wu.pct/100, toLb);
          const disp = fmtKgLb(kg,toLb);
          const cur = getSetPairDisplay(w, day, liftCode, 'warm', i);
          warm += `<li>${wu.pct}% × ${wu.reps} → <b>${disp}</b>
            <div class="row mini">Log:</div>
            <div class="inpwrap"><input id="wt_${w}_${day}_${liftCode}_warm_${i}" type="number" inputmode="decimal" placeholder="${toLb?'lb':'kg'}" value="${cur.wt}" oninput="saveSetPair(${w}, '${day}', '${liftCode}', 'warm', ${i})">
            <input id="rp_${w}_${day}_${liftCode}_warm_${i}" type="number" inputmode="numeric" placeholder="reps" value="${cur.rp}" oninput="saveSetPair(${w}, '${day}', '${liftCode}', 'warm', ${i})"></div>
          </li>`;
        });
        warm += '</ul>';
        // Work
        let work = '<h5>Work</h5><ul>';
        if(item.p && item.p.length===1){
          const p = item.p[0];
          const kg = roundLoad((oneRMs[liftCode]||0)*p/100, toLb);
          const disp = fmtKgLb(kg,toLb);
          const mSets = (item.s.match(/(\d+)\s*×/)||[null,null])[1];
          const mReps = (item.s.match(/×\s*(\d+)\s*@/)||[null,null])[1];
          const line = (mSets&&mReps)? `${mSets}×${mReps} @ ${p}% → <b>${disp}</b>` : `${item.s} → <b>${disp}</b>`;
          const cur = getSetPairDisplay(w, day, liftCode, 'work', 0);
          work += `<li>${line}
            <div class="row mini">Log:</div>
            <div class="inpwrap"><input id="wt_${w}_${day}_${liftCode}_work_0" type="number" inputmode="decimal" placeholder="${toLb?'lb':'kg'}" value="${cur.wt}" oninput="saveSetPair(${w}, '${day}', '${liftCode}', 'work', 0)">
            <input id="rp_${w}_${day}_${liftCode}_work_0" type="number" inputmode="numeric" placeholder="reps" value="${cur.rp}" oninput="saveSetPair(${w}, '${day}', '${liftCode}', 'work', 0)"></div>
          </li>`;
        } else if(item.p && item.p.length>1){
          item.p.forEach((p,i)=>{
            const kg = roundLoad((oneRMs[liftCode]||0)*p/100, toLb);
            const disp = fmtKgLb(kg,toLb);
            const cur = getSetPairDisplay(w, day, liftCode, 'work', i);
            work += `<li>@ ${p}% → <b>${disp}</b>
              <div class="row mini">Log:</div>
              <div class="inpwrap"><input id="wt_${w}_${day}_${liftCode}_work_${i}" type="number" inputmode="decimal" placeholder="${toLb?'lb':'kg'}" value="${cur.wt}" oninput="saveSetPair(${w}, '${day}', '${liftCode}', 'work', ${i})">
              <input id="rp_${w}_${day}_${liftCode}_work_${i}" type="number" inputmode="numeric" placeholder="reps" value="${cur.rp}" oninput="saveSetPair(${w}, '${day}', '${liftCode}', 'work', ${i})"></div>
            </li>`;
          });
        } else {
          work += `<li>${item.s}</li>`;
        }
        work += '</ul>';
        out.innerHTML += warm + work;
      }

      // Primers
      function primersFor(day, block){
        if(day==='Lower A'){
          if(block===1) return ['Box Jumps — bodyweight, 4×3','Countermovement Jumps — bodyweight, 4×3'];
          if(block===2) return ['Squat + Jump Contrast — 2–3 jump squats @20–25% after sets'];
          return ['Jump Squats/Trap‑bar Jumps — 5–6×3 @20–30% 1RM'];
        }
        if(day==='Lower B'){
          return ['Med-Ball Scoop Toss — 4×3','Pogo Jumps — bodyweight, 2–3×20–30 sec','Bounds — bodyweight, 2–3×10–15 contacts'];
        }
        if(day==='Upper A'){
          return ['Med-Ball Chest Pass — medicine ball 3–5 kg, 5×3'];
        }
        return ['Tall Clean Drill / Push Jerk Primer — barbell or PVC, 3–4×3'];
      }
      out.innerHTML += '<h4>Power</h4>' + list(primersFor(day, block));

      // Main
      if(day==='Lower A'){
        out.innerHTML += `<h4>Main — ${linkify('Back Squat')}</h4><div class="mono">${plan.SQ[w-1].s}</div>`;
        if(w!==15) warmWorkBlocks('SQ');
      } else if(day==='Upper A'){
        out.innerHTML += `<h4>Main — ${linkify('Dumbbell Bench Press')}</h4><div class="mono">${plan.BP[w-1].s}</div>`;
        if(w!==15) warmWorkBlocks('BP');
      } else if(day==='Lower B'){
        out.innerHTML += `<h4>Main — ${linkify('Deadlift')}</h4><div class="mono">${plan.DL[w-1].s}</div>`;
        if(w!==15) warmWorkBlocks('DL');
      } else {
        out.innerHTML += `<h4>Main — ${linkify('Clean')}</h4><div class="mono">${plan.CLN[w-1].s}</div>`;
        if(w!==15) warmWorkBlocks('CLN');
      }

      // Accessories + logging
      function accessoriesFor(day){
        if(day==='Lower A'){
          return ['RDL','Bulgarian Split Squat','Standing Calf Raise','Ab Rollout / Suitcase Carry'];
        }
        if(day==='Upper A'){
          return ['Incline DB Bench','One‑Arm DB Row','Ring Dips','Triceps (Pushdown/DB Skullcrusher)'];
        }
        if(day==='Lower B'){
          return ['Front Squat','Hack Squat','Hamstring Curl','Farmer’s/Suitcase Carry','Pallof Press'];
        }
        return ['Overhead Press','Weighted Pull‑ups','Muscle-ups','Handstand Push-ups','Facepulls / Rear Delt Rows','DB Biceps Curls'];
      }
      out.innerHTML += '<h4>Accessories</h4>'+list(accessoriesFor(day).map(n=>n+' — log top set below'));
      out.innerHTML += '<h4>Accessory Logging</h4>';
      accessoriesFor(day).forEach((nm,i)=>{
        const cur = getAccessoryPairDisplay(w, day, nm);
        out.innerHTML += `<div class="row" style="margin:6px 0;justify-content:space-between;align-items:center">
          <div class="small" style="flex:1">${linkify(nm)}</div>
          <div class="inpwrap">
            <input id="aw_${w}_${day}_${nm}" type="number" inputmode="decimal" placeholder="${toLb?'lb':'kg'}" value="${cur.wt}" oninput="saveAccessoryPair(${w}, '${day}', '${nm}')">
            <input id="ar_${w}_${day}_${nm}" type="number" inputmode="numeric" placeholder="reps" value="${cur.rp}" oninput="saveAccessoryPair(${w}, '${day}', '${nm}')">
          </div>
        </div>`;
      });

      if(day==='Lower A'){
        out.innerHTML += '<h4>Finisher</h4>'+list(['Accelerations — 4–6×20 m (2:00 rest)']);
      }

      if(w===15){
        out.innerHTML = '<h4>Testing Protocol (Week 15)</h4><ul>' +
          '<li><b>Back Squat</b>: 60–70–80–85–90–95–100% x1</li>' +
          '<li><b>Dumbbell Bench Press</b>: 60–70–80–85–90–95% x1</li>' +
          '<li><b>Deadlift</b>: 60–70–80–85–90–95–100% x1</li>' +
          '<li><b>Clean</b>: 60–70–75–80–85–90–95% x1</li>' +
          '</ul><div class="small">Quality over load on cleans. Stop if technique breaks.</div>';
      }
    }

    function renderWeekly(){
      const w = parseInt(document.getElementById('weekSelectWeekly').value);
      const block = blockForWeek(w);
      const blurb = block==='deload5' ? 'Deload Week — reduce accessory volume ~40–50%.' :
                     block==='deload10'? 'Deload + AMRAPs @70% (auto-regulate next block).' :
                     block==='test15' ? 'Testing Week — spread lifts/tests; keep volume minimal.' :
                     (block===1?'Block 1: Base & Hypertrophy': block===2?'Block 2: Intensification':'Block 3: Peak Power/Strength');
      document.getElementById('weeklyMeta').innerHTML = `<b>Week ${w}</b> — ${blurb}`;

      const rows = [
        {day:'Lower A', main:'Back Squat', key:'Jumps/Accel + RDL/Split Squat'},
        {day:'Upper A', main:'Dumbbell Bench Press', key:'MB Chest Pass + Row/Triceps + Ring Dips'},
        {day:'Lower B', main:'Deadlift', key:'MB Scoop Toss + Front/Hack + Carries'},
        {day:'Upper B', main:'Clean', key:'Jerk Primer + OHP + Pull-ups + Gymnastics'}
      ];
      let html = `<table><thead><tr><th>Day</th><th>Main Lift</th><th>Key Add‑Ons</th></tr></thead><tbody>`;
      rows.forEach(r=>{ html += `<tr><td>${r.day}</td><td>${r.main}</td><td>${r.key}</td></tr>`; });
      html += `</tbody></table>`;
      document.getElementById('weeklyOut').innerHTML = html;
    }

    // ---------- Persist 1RMs ----------
    function saveVals(){
      const data = {
        sq: document.getElementById('sq').value,
        bp: document.getElementById('bp').value,
        dl: document.getElementById('dl').value,
        cln: document.getElementById('cln').value,
        lb: document.getElementById('lb').checked,
        useTM: document.getElementById('useTM').checked
      };
      localStorage.setItem('planVals', JSON.stringify(data));
      document.getElementById('status').textContent = 'Saved';
      buildSessionMaxes();
      renderDaily();
      renderWeekly();
    }
    function loadVals(){
      const raw = localStorage.getItem('planVals'); if(!raw) return;
      try{
        const d = JSON.parse(raw);
        if(d.sq) document.getElementById('sq').value = d.sq;
        if(d.bp) document.getElementById('bp').value = d.bp;
        if(d.dl) document.getElementById('dl').value = d.dl;
        if(d.cln) document.getElementById('cln').value = d.cln;
        if(typeof d.lb==='boolean') document.getElementById('lb').checked = d.lb;
        if(typeof d.useTM==='boolean') document.getElementById('useTM').checked = d.useTM;
        document.getElementById('status').textContent = 'Loaded';
      }catch(e){}
    }

    // ---------- Wire up ----------
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });
    document.getElementById('saveBtn').addEventListener('click', saveVals);
    document.getElementById('quickCalc').addEventListener('click', ()=>{
      if(!document.getElementById('sq').value){ document.getElementById('sq').value = 180; }
      if(!document.getElementById('bp').value){ document.getElementById('bp').value = 120; }
      if(!document.getElementById('dl').value){ document.getElementById('dl').value = 220; }
      if(!document.getElementById('cln').value){ document.getElementById('cln').value = 110; }
      saveVals();
    });
    ['sq','bp','dl','cln','useTM','lb'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('change', ()=>{ buildSessionMaxes(); renderDaily(); renderWeekly(); });
    });
    document.getElementById('lbDaily').addEventListener('change', renderDaily);
    document.getElementById('seasonedDaily').addEventListener('change', renderDaily);
    document.getElementById('seasonedWeekly').addEventListener('change', renderWeekly);

    // Week selectors
    const weekSel = document.getElementById('weekSelect');
    const weekSelW = document.getElementById('weekSelectWeekly');
    for(let i=1;i<=15;i++){ const o=document.createElement('option'); o.textContent=i; o.value=i; weekSel.appendChild(o);
      const o2=document.createElement('option'); o2.textContent=i; o2.value=i; weekSelW.appendChild(o2); }
    weekSel.value="1"; weekSelW.value="1";
    weekSel.addEventListener('change', renderDaily);
    weekSelW.addEventListener('change', renderWeekly);
    document.getElementById('daySelect').addEventListener('change', renderDaily);

    // Init
    loadVals();
    renderDaily();
    renderWeekly();
    buildSessionMaxes();
  </script>
</body>
</html>
