
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>Training Plan — Programming Build</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f1115">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-512.png">
  <style>
    :root{ --bg:#0f1115; --card:#171a21; --text:#e8eaf0; --muted:#a8b3c3; --accent:#5ec4ff; --border:#222633; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial}
    header{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(15,17,21,.95),rgba(15,17,21,.75));backdrop-filter:saturate(150%) blur(8px);padding:12px 14px;border-bottom:1px solid var(--border)}
    h1{font-size:18px;margin:0}
    .sub{color:var(--muted);font-size:12px;margin-top:4px}
    .tabs{display:flex;gap:6px;margin:10px 14px 0 14px;overflow-x:auto;padding-bottom:6px}
    .tab{flex:0 0 auto;padding:10px 12px;border:1px solid var(--border);border-radius:10px;background:var(--card);color:var(--text);font-weight:600;font-size:13px;white-space:nowrap}
    .tab.active{outline:2px solid var(--accent)}
    main{padding:12px 14px 90px 14px}
    section{display:none}
    section.active{display:block}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:12px}
    label{display:inline-flex;align-items:center;gap:6px;margin:6px 8px 6px 0;font-size:14px;color:var(--muted)}
    input[type="number"], select{padding:8px;border-radius:10px;border:1px solid var(--border);background:#0b0d12;color:var(--text)}
    input[type="number"]{width:90px}
    .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
    .btn{appearance:none;border:none;border-radius:10px;background:var(--accent);color:#001721;font-weight:700;padding:10px 12px;font-size:14px}
    .btn.secondary{background:#263244;color:var(--text);border:1px solid var(--border)}
    .switch{display:inline-flex;align-items:center;gap:8px;cursor:pointer;padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:#0b0d12}
    .switch input{appearance:none;width:16px;height:16px;border-radius:4px;border:1px solid var(--border);margin:0;background:#12151c}
    .switch input:checked{background:var(--accent)}
    table{width:100%;border-collapse:collapse;font-size:12px;margin-top:8px}
    th,td{border-bottom:1px solid var(--border);padding:8px;text-align:center}
    th{position:sticky;top:0;background:#12151c;z-index:1}
    .small{font-size:12px;color:var(--muted)}
    ul{margin:0 0 0 18px}
    li{margin:6px 0}
    .footer{position:fixed;bottom:0;left:0;right:0;background:linear-gradient(0deg,rgba(15,17,21,.95),rgba(15,17,21,.6));backdrop-filter:blur(8px);border-top:1px solid var(--border);padding:10px 14px;display:flex;justify-content:space-between;align-items:center;gap:10px}
    .pill{border:1px solid var(--border);background:#0b0d12;border-radius:12px;padding:6px 10px;color:var(--muted);font-size:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace}
  </style>
</head>
<body>
  <header>
    <h1>15‑Week Training Plan — Programming Build</h1>
    <div class="sub">Hypertrophy + Athletic Performance • modular app-ready</div>
  </header>

  <div class="tabs" id="tabs">
    <button class="tab active" data-tab="daily">Daily</button>
    <button class="tab" data-tab="weekly">Weekly</button>
    <button class="tab" data-tab="calc">Main Lifts</button>
    <button class="tab" data-tab="about">About</button>
  </div>

  <main>
    <!-- Daily View -->
    <section id="daily" class="active">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center">
          <div>
            <h3 style="margin:0 0 8px 0">Daily Planner</h3>
            <div class="small">Pick Week & Day. You’ll see athletic primers, main lifts with warm-ups/work, accessories, and notes. Exercise names link to tutorials.</div>
          </div>
          <div class="row" style="gap:6px">
            <label class="switch"><input id="seasonedDaily" type="checkbox">Seasoned</label>
            <label class="switch"><input id="lbDaily" type="checkbox">lb</label>
          </div>
        </div>
        <div class="row" style="gap:10px;margin-top:8px">
          <label>Week
            <select id="weekSelect"></select>
          </label>
          <label>Day
            <select id="daySelect">
              <option>Lower A</option>
              <option>Upper A</option>
              <option>Lower B</option>
              <option>Upper B</option>
            </select>
          </label>
        </div>
      </div>
      <div class="card" id="dailyMeta"></div>
      <div class="card" id="dailyOut"></div>
    </section>

    <!-- Weekly Overview (no % in overview; details toggle shows warm-up/work) -->
    <section id="weekly">
      <div class="card">
        <h3>Weekly Overview</h3>
        <div class="row" style="gap:10px">
          <label>Week
            <select id="weekSelectWeekly"></select>
          </label>
          <label class="switch"><input id="seasonedWeekly" type="checkbox">Seasoned</label>
          <label class="switch"><input id="lbWeekly" type="checkbox">lb</label>
        </div>
        <div class="small" id="weeklyMeta"></div>
      </div>
      <div class="card" id="weeklyOut"></div>
    </section>

    <!-- Calculator (1RM) -->
    <section id="calc">
      <div class="card">
        <div class="row">
          <label>Squat 1RM <input id="sq" type="number" inputmode="decimal" placeholder="kg"></label>
          <label>Bench 1RM <input id="bp" type="number" inputmode="decimal" placeholder="kg"></label>
          <label>Deadlift 1RM <input id="dl" type="number" inputmode="decimal" placeholder="kg"></label>
          <label>Clean 1RM <input id="cln" type="number" inputmode="decimal" placeholder="kg"></label>
        </div>
        <div class="row" style="margin-top:6px">
          <label class="switch"><input id="useTM" type="checkbox">Use Training Max (90%)</label>
          <label class="switch"><input id="lb" type="checkbox">Show in lb</label>
          <button class="btn" id="calcBtn">Calculate</button>
          <button class="btn secondary" id="saveBtn">Save</button>
          <span class="pill" id="status">Unsaved</span>
        </div>
        <div class="small" style="margin-top:6px">Note: Bench work is performed with <b>dumbbells</b>; % calculations still anchor to your barbell Bench 1RM for consistency.</div>
      </div>
      <div class="card">
        <strong>Main Lifts Progression</strong>
        <div class="small">Prescriptions shown as <span class="mono">sets×reps @ %</span>. Loads auto‑calc and round to the nearest 2.5 kg (or 5 lb).</div>
        <div id="tableWrap"></div>
      </div>
    </section>

    <!-- About / Philosophy -->
    <section id="about">
      <div class="card">
        <h3>Programming Philosophy</h3>
        <p>Three phases with deloads and testing, blending <b>hypertrophy</b> with <b>athletic performance</b> (jumps, throws, speed). Main lifts: Back Squat, <b>Dumbbell Bench Press</b> (as main pressing stimulus), Deadlift, and Clean. Overhead Press moves to accessories.</p>
        <ul>
          <li><b>Block 1 (Weeks 1–4): Base & Hypertrophy</b> — higher reps, primers to build springiness; movement quality first.</li>
          <li><b>Week 5: Deload</b> — volume reduced ~40–50%; technique singles and mini-tests.</li>
          <li><b>Block 2 (Weeks 6–9): Intensification</b> — %s rise, reps drop; contrast/power emphasis.</li>
          <li><b>Week 10: Deload + AMRAPs</b> — easy work with one AMRAP @70% to estimate e1RM.</li>
          <li><b>Block 3 (Weeks 11–14): Peak Power/Strength</b> — heavy doubles/singles with low contact plyos.</li>
          <li><b>Week 15: Testing</b> — distributed testing; minimal accessories.</li>
        </ul>
      </div>
    </section>
  </main>

  <div class="footer">
    <span class="pill">Blocks: (1) Base • (2) Intensify • (3) Peak • (15) Test</span>
    <button class="btn" id="quickCalc">Quick Calc</button>
  </div>

  <script>
    // Helpers
    function roundLoad(x, toLb){ const step = toLb ? 5 : 2.5; return Math.round(x/step)*step; }
    function fmt(x, toLb){ return toLb ? (x*2.20462).toFixed(0) : x.toFixed(1); }
    function blockForWeek(w){ if(w>=1&&w<=4) return 1; if(w===5) return 'deload5'; if(w>=6&&w<=9) return 2; if(w===10) return 'deload10'; if(w>=11&&w<=14) return 3; if(w===15) return 'test15'; }

    // --- YouTube tutorials map (curated) ---
    const YT = {
      "Back Squat":"https://www.youtube.com/watch?v=SbgHegC6lEs",
      "Front Squat":"https://www.youtube.com/watch?v=7pyxT5hqmQY",
      "Deadlift":"https://www.youtube.com/watch?v=Y1IGeJEXpF4",
      "Romanian Deadlift":"https://www.youtube.com/watch?v=_oyxCn2iSjU",
      "RDL":"https://www.youtube.com/watch?v=_oyxCn2iSjU",
      "Bench Press":"https://www.youtube.com/watch?v=gRVjAtPip0Y",
      "Dumbbell Bench Press":"https://www.youtube.com/watch?v=VmB1G1K7v94",
      "Incline DB Bench":"https://www.youtube.com/watch?v=8iPEnn-ltC8",
      "Overhead Press":"https://www.youtube.com/watch?v=wol7Hko8RhY",
      "Barbell Row":"https://www.youtube.com/watch?v=vT2GjY_Umpw",
      "Biceps Curls":"https://www.youtube.com/watch?v=ykJmrZ5v0Oo",
      "Clean":"https://www.youtube.com/watch?v=oQIaWLrB318",
      "Power Clean":"https://www.youtube.com/watch?v=YG8M_-11C2A",
      "Push Press":"https://www.youtube.com/watch?v=yklSQG1_Ovc",
      "Push Jerk":"https://www.youtube.com/watch?v=Om7vLD6x8W0",
      "Ring Dips":"https://www.youtube.com/watch?v=NbUOZOKzmIQ",
      "Muscle-ups":"https://www.youtube.com/watch?v=Jv7L8j-SZYc",
      "Handstand Push-ups":"https://www.youtube.com/watch?v=YWlO1RGzkmE",
      "Pull-up":"https://www.youtube.com/watch?v=eGo4IYlbE5g",
      "Box Jumps":"https://www.youtube.com/watch?v=52r_Ul5k03g",
      "Countermovement Jumps":"https://www.youtube.com/watch?v=IqE2w2nQ4t8",
      "Pogo Jumps":"https://www.youtube.com/watch?v=OUiAqG2YpGg",
      "Pogo Hops":"https://www.youtube.com/watch?v=OUiAqG2YpGg",
      "Bounds":"https://www.youtube.com/watch?v=Jf4fe2bC5mY",
      "Med-Ball Chest Pass":"https://www.youtube.com/watch?v=FhS7b2YqvSA",
      "Med-Ball Scoop Toss":"https://www.youtube.com/watch?v=tiN9ZtG6u1g",
      "Farmer’s Carry":"https://www.youtube.com/watch?v=a2h5n2WcQdY",
      "Suitcase Carry":"https://www.youtube.com/watch?v=CLt2d4B3W-E",
      "Pallof Press":"https://www.youtube.com/watch?v=i2cQfKk8wNs",
      "Ab Rollout":"https://www.youtube.com/watch?v=Fm3w7hTbdG8",
      "Calf Raise":"https://www.youtube.com/watch?v=YMmgqO8Jo-k"
    };
    function linkify(name){
      for(const key of Object.keys(YT)){
        if(name.toLowerCase().includes(key.toLowerCase())){
          const url = YT[key];
          return name.replace(new RegExp(key, 'i'), `<a href="${url}" target="_blank" rel="noopener">${key}</a>`);
        }
      }
      return name;
    }
    function list(items){
      return '<ul>'+items.map(x=>`<li>${linkify(x)}</li>`).join('')+'</ul>';
    }

    // Plan data (SQ, DB Bench (as BP %), DL, Clean)
    const plan = {
      SQ:[
        {w:1,s:"5×8 @65%",p:[65]},{w:2,s:"5×8 @67.5%",p:[67.5]},{w:3,s:"4×8 @70%",p:[70]},{w:4,s:"4×8 @72.5%",p:[72.5]},
        {w:5,s:"3×5 @60% + 2×1 @80%",p:[60,80]},
        {w:6,s:"5×5 @75%",p:[75]},{w:7,s:"5×4 @80%",p:[80]},{w:8,s:"6×3 @82.5%",p:[82.5]},{w:9,s:"5×3 @85%",p:[85]},
        {w:10,s:"3×3 @65% + AMRAP @70%",p:[65,70]},
        {w:11,s:"5×3 @85%",p:[85]},{w:12,s:"6×2 @87.5%",p:[87.5]},{w:13,s:"5×2 @90%",p:[90]},{w:14,s:"4×1–2 @92.5%",p:[92.5]},
        {w:15,s:"Test 1RM",p:[]}
      ],
      BP:[
        {w:1,s:"DB Bench 5×8 @65% (of BP 1RM)",p:[65]},{w:2,s:"DB Bench 5×8 @67.5%",p:[67.5]},{w:3,s:"DB Bench 4×8 @70%",p:[70]},{w:4,s:"DB Bench 4×8 @72.5%",p:[72.5]},
        {w:5,s:"DB Bench 3×5 @60% + 2×1 @80%",p:[60,80]},
        {w:6,s:"DB Bench 5×5 @75%",p:[75]},{w:7,s:"DB Bench 5×4 @80%",p:[80]},{w:8,s:"DB Bench 6×3 @82.5%",p:[82.5]},{w:9,s:"DB Bench 5×3 @85%",p:[85]},
        {w:10,s:"DB Bench 3×3 @65% + AMRAP @70%",p:[65,70]},
        {w:11,s:"DB Bench 5×3 @85%",p:[85]},{w:12,s:"DB Bench 6×2 @87.5%",p:[87.5]},{w:13,s:"DB Bench 5×2 @90%",p:[90]},{w:14,s:"DB Bench 4×1–2 @92.5%",p:[92.5]},
        {w:15,s:"Test 1RM (DB Bench anchored to BP 1RM)",p:[]}
      ],
      DL:[
        {w:1,s:"4×6 @70%",p:[70]},{w:2,s:"4×6 @72.5%",p:[72.5]},{w:3,s:"5×5 @75%",p:[75]},{w:4,s:"4×5 @77.5%",p:[77.5]},
        {w:5,s:"3×3 @60–65% + 2×1 @80%",p:[62.5,80]},
        {w:6,s:"5×4 @77.5%",p:[77.5]},{w:7,s:"6×3 @80%",p:[80]},{w:8,s:"5×3 @82.5%",p:[82.5]},{w:9,s:"4×3 @85%",p:[85]},
        {w:10,s:"3×2 @65% + AMRAP @70%",p:[65,70]},
        {w:11,s:"5×2–3 @85%",p:[85]},{w:12,s:"5×2 @87.5%",p:[87.5]},{w:13,s:"4×2 @90%",p:[90]},{w:14,s:"3×1–2 @92.5%",p:[92.5]},
        {w:15,s:"Test 1RM",p:[]}
      ],
      CLN:[
        {w:1,s:"5×3 @60%",p:[60]},{w:2,s:"5×3 @65%",p:[65]},{w:3,s:"6×2 @70%",p:[70]},{w:4,s:"6×2 @72.5%",p:[72.5]},
        {w:5,s:"3×2 @60–65%",p:[62.5]},
        {w:6,s:"5×2 @75%",p:[75]},{w:7,s:"6×2 @77.5%",p:[77.5]},{w:8,s:"5×2 @80%",p:[80]},{w:9,s:"4×2 @82.5%",p:[82.5]},
        {w:10,s:"3×2 @65% + AMRAP technique @70%",p:[65,70]},
        {w:11,s:"4×2 @85%",p:[85]},{w:12,s:"5×1–2 @87.5%",p:[87.5]},{w:13,s:"4×1–2 @90%",p:[90]},{w:14,s:"3×1 @92.5%",p:[92.5]},
        {w:15,s:"Test 1RM Clean",p:[]}
      ]
    };
    const lifts = ["SQ","BP","DL","CLN"];
    const names = {SQ:"Back Squat", BP:"Dumbbell Bench Press", DL:"Deadlift", CLN:"Clean"};

    // Seasoned variant (top + back-offs) when a single % is used
    function seasonedVariant(item){
      if(!item.p || item.p.length!==1) return null;
      const m = item.s.match(/(\d+)×(\d+)/);
      if(!m) return null;
      const reps = parseInt(m[2],10);
      const basePct = item.p[0];
      const boPct = Math.round(basePct*0.925*2)/2;
      return { top:{reps,p:basePct}, back:{sets:3,reps,p:boPct} };
    }
    function pctLoadsForWeek(liftKey, week, oneRMs, toLb, seasoned){
      const item = plan[liftKey][week-1];
      if(seasoned){
        const v = seasonedVariant(item);
        if(v){
          const one = oneRMs[liftKey]||0;
          const top = roundLoad(one*v.top.p/100, toLb);
          const bo  = roundLoad(one*v.back.p/100, toLb);
          return {text:item.s, variant:v, loads:{top:fmt(top,toLb), bo:fmt(bo,toLb), unit: toLb?'lb':'kg' }};
        }
      }
      const loads = (item.p||[]).map(p=>{
        const kg = (oneRMs[liftKey]||0)*p/100;
        const r = roundLoad(kg,toLb);
        return `${fmt(r,toLb)} ${toLb?'lb':'kg'} @${p}%`;
      });
      return {text:item.s, loads, unit: toLb?'lb':'kg'};
    }

    // Tailored warm-ups
    function warmupsFor(liftKey, targetPct){
      const t = targetPct || 60;
      if(liftKey==='SQ'){
        if(t<=65) return [{pct:40,reps:5},{pct:55,reps:3}];
        if(t<=75) return [{pct:40,reps:5},{pct:55,reps:3},{pct:65,reps:2}];
        if(t<=85) return [{pct:40,reps:5},{pct:55,reps:3},{pct:65,reps:2},{pct:75,reps:1}];
        return [{pct:40,reps:5},{pct:55,reps:3},{pct:65,reps:2},{pct:75,reps:1},{pct:85,reps:1}];
      }
      if(liftKey==='BP'){
        if(t<=65) return [{pct:40,reps:8},{pct:50,reps:5}];
        if(t<=75) return [{pct:40,reps:8},{pct:50,reps:5},{pct:60,reps:3}];
        if(t<=85) return [{pct:40,reps:8},{pct:50,reps:5},{pct:60,reps:3},{pct:70,reps:1}];
        return [{pct:40,reps:8},{pct:50,reps:5},{pct:60,reps:3},{pct:70,reps:1},{pct:80,reps:1}];
      }
      if(liftKey==='DL'){
        if(t<=65) return [{pct:45,reps:5},{pct:60,reps:3}];
        if(t<=75) return [{pct:45,reps:5},{pct:60,reps:3},{pct:70,reps:1}];
        if(t<=85) return [{pct:45,reps:5},{pct:60,reps:3},{pct:70,reps:1},{pct:80,reps:1}];
        return [{pct:45,reps:5},{pct:60,reps:3},{pct:70,reps:1},{pct:80,reps:1},{pct:85,reps:1}];
      }
      if(liftKey==='CLN'){
        if(t<=65) return [{pct:40,reps:3},{pct:50,reps:2},{pct:60,reps:2}];
        if(t<=75) return [{pct:40,reps:3},{pct:50,reps:2},{pct:60,reps:2},{pct:70,reps:1}];
        if(t<=85) return [{pct:40,reps:3},{pct:50,reps:2},{pct:60,reps:2},{pct:70,reps:1},{pct:80,reps:1}];
        return [{pct:40,reps:3},{pct:50,reps:2},{pct:60,reps:2},{pct:70,reps:1},{pct:80,reps:1},{pct:85,reps:1}];
      }
      return [{pct:40,reps:5},{pct:55,reps:3}];
    }
    function setLines(liftKey, weekItem, oneRMs, toLb){
      const one = oneRMs[liftKey]||0;
      const workPcts = (weekItem.p||[]);
      const target = workPcts.length ? workPcts[0] : 60;
      const warms = warmupsFor(liftKey, target);
      const warmLines = warms.map(wu=>{
        const load = roundLoad(one*wu.pct/100, toLb);
        return `${wu.pct}% × ${wu.reps} → <b>${fmt(load,toLb)} ${toLb?'lb':'kg'}</b>`;
      });
      let workLines = [];
      if(workPcts.length===1){
        const p = workPcts[0];
        const repsMatch = (weekItem.s.match(/×(\d+)\s*@/) || [null, null])[1];
        const reps = repsMatch ? parseInt(repsMatch,10) : null;
        const setsMatch = (weekItem.s.match(/(\d+)\s*×/) || [null, null])[1];
        const sets = setsMatch ? parseInt(setsMatch,10) : null;
        const load = roundLoad(one*p/100, toLb);
        if(sets && reps){
          workLines.push(`${sets}×${reps} @ ${p}% → <b>${fmt(load,toLb)} ${toLb?'lb':'kg'}</b>`);
        } else {
          workLines.push(`${weekItem.s} → <b>${fmt(load,toLb)} ${toLb?'lb':'kg'}</b>`);
        }
      }else if(workPcts.length>1){
        workLines = workPcts.map(p=>{
          const load = roundLoad(one*p/100, toLb);
          return `@ ${p}% → <b>${fmt(load,toLb)} ${toLb?'lb':'kg'}</b>`;
        });
        workLines.unshift(weekItem.s);
      }else{
        workLines = [weekItem.s];
      }
      return {warmLines, workLines};
    }

    function weekOverview(week){
      const block = blockForWeek(week);
      let msg = block===1?'Block 1: Base & Hypertrophy': block===2?'Block 2: Intensification': block===3?'Block 3: Peak Power/Strength': block==='deload5'?'Deload Week 5 — reduce accessories 40–50%': block==='deload10'?'Deload Week 10 + AMRAP @70%':'Testing Week 15';
      return msg;
    }

    // Populate week selects
    const weekSel = document.getElementById('weekSelect');
    const weekSelW = document.getElementById('weekSelectWeekly');
    for(let i=1;i<=15;i++){
      const o = document.createElement('option'); o.textContent = i; o.value = i; weekSel.appendChild(o);
      const o2= document.createElement('option'); o2.textContent= i; o2.value = i; weekSelW.appendChild(o2);
    }
    weekSel.value = "1"; weekSelW.value = "1";

    function renderDaily(){
      const w = parseInt(weekSel.value);
      const day = document.getElementById('daySelect').value;
      const block = blockForWeek(w);
      const toLb = document.getElementById('lbDaily').checked || document.getElementById('lb').checked;
      const seasoned = document.getElementById('seasonedDaily').checked;

      // 1RMs
      let sq = parseFloat(document.getElementById('sq').value||0);
      let bp = parseFloat(document.getElementById('bp').value||0);
      let dl = parseFloat(document.getElementById('dl').value||0);
      let cln= parseFloat(document.getElementById('cln').value||0);
      const useTM = document.getElementById('useTM').checked;
      if(useTM){ sq*=0.9; bp*=0.9; dl*=0.9; cln*=0.9; }
      const oneRMs = {SQ:sq, BP:bp, DL:dl, CLN:cln};

      // Blurb
      let blurb = weekOverview(w);
      document.getElementById('dailyMeta').innerHTML = `<b>Week ${w}</b> — ${day}<br><span class="small">${blurb}</span>`;

      // Builders
      let out = '';

      if(day==='Lower A'){
        if(block===1) out += '<h4>Power</h4>'+list(['Box Jumps — bodyweight, 4×3','Countermovement Jumps — bodyweight, 4×3']);
        if(block===2) out += '<h4>Power</h4>'+list(['Squat + Jump Contrast — 2–3 jump squats @20–25% after sets']);
        if(block===3) out += '<h4>Power</h4>'+list(['Jump Squats/Trap‑bar Jumps — 5–6×3 @20–30% 1RM']);
        const L = pctLoadsForWeek('SQ', w, oneRMs, toLb, seasoned);
        out += `<h4>Main — ${linkify('Back Squat')}</h4><div class="mono">${L.text}</div>`;
        if(w!==15){
          const det = setLines('SQ', plan['SQ'][w-1], oneRMs, toLb);
          out += '<h5>Warm-up</h5>'+list(det.warmLines);
          out += '<h5>Work</h5>'+list(det.workLines);
        }
        out += '<h4>Accessories</h4>'+list(['RDL — barbell, 3–4×8–10','Bulgarian Split Squat — dumbbells at sides, 3×10–12/leg','Standing Calf Raise — dumbbells or machine, 3×12–15','Core anti‑flexion — ab rollout (barbell/wheel) or suitcase carries (dumbbells)']);
        out += '<h4>Finisher</h4>'+list(['Accelerations — 4–6×20 m (2:00 rest)']);
      }

      if(day==='Upper A'){
        out += '<h4>Power</h4>'+list(['Med-Ball Chest Pass — medicine ball 3–5 kg, 5×3']);
        const L = pctLoadsForWeek('BP', w, oneRMs, toLb, seasoned);
        out += `<h4>Main — ${linkify('Dumbbell Bench Press')}</h4><div class="mono">${L.text}</div>`;
        if(w!==15){
          const det = setLines('BP', plan['BP'][w-1], oneRMs, toLb);
          out += '<h5>Warm-up</h5>'+list(det.warmLines);
          out += '<h5>Work</h5>'+list(det.workLines);
        }
        out += '<h4>Accessories</h4>'+list(['Incline DB Bench — dumbbells, 3–4×8–12','One‑Arm DB Row — dumbbell + bench support, 4×8–10','Ring Dips — rings, 3–4×AMRAP (weighted if strong)','Triceps — rope pushdown (band/cable) or dumbbell skullcrushers, 3×10–15']);
      }

      if(day==='Lower B'){
        out += '<h4>Power</h4>'+list(['Med-Ball Scoop Toss — 4×3','Pogo Jumps — bodyweight, 2–3×20–30 sec','Bounds — bodyweight, 2–3×10–15 contacts']);
        const L = pctLoadsForWeek('DL', w, oneRMs, toLb, seasoned);
        out += `<h4>Main — ${linkify('Deadlift')}</h4><div class="mono">${L.text}</div>`;
        if(w!==15){
          const det = setLines('DL', plan['DL'][w-1], oneRMs, toLb);
          out += '<h5>Warm-up</h5>'+list(det.warmLines);
          out += '<h5>Work</h5>'+list(det.workLines);
        }
        out += '<h4>Accessories</h4>'+list(['Front Squat — barbell, 3–4×6–8','Hack Squat — barbell behind legs or machine, 3×6–8','Hamstring Curl — machine/band/sliders, 3–4×10–15','Farmer’s/Suitcase Carry — heavy dumbbells, 3 rounds','Anti‑rotation — Pallof Press (band/cable)']);
      }

      if(day==='Upper B'){
        out += '<h4>Power</h4>'+list(['Tall Clean Drill / Push Jerk Primer — barbell or PVC, 3–4×3']);
        const L = pctLoadsForWeek('CLN', w, oneRMs, toLb, seasoned);
        out += `<h4>Main — ${linkify('Clean')}</h4><div class="mono">${L.text}</div>`;
        if(w!==15){
          const det = setLines('CLN', plan['CLN'][w-1], oneRMs, toLb);
          out += '<h5>Warm-up</h5>'+list(det.warmLines);
          out += '<h5>Work</h5>'+list(det.workLines);
        }
        out += '<h4>Accessories</h4>'+list(['Overhead Press — DBs or barbell, 3–4×6–8','Weighted Pull‑ups — dip belt or DB between feet, 4×6–8','Muscle-ups — rings/bar, 3–4×quality sets (or progression)','Handstand Push-ups — wall‑assisted or free, 3–5×quality','Facepulls / Rear Delt Rows — bands/cables, 3×12–15','DB Biceps Curls — dumbbells, 2–3×10–15']);
      }

      // Week 15 special protocol
      if(w===15){
        let proto = '<h4>Testing Protocol (Week 15)</h4>';
        function testSteps(lift, percents){ return `<li><b>${lift}</b>: `+percents.map(p=>`${p}% x1`).join(' → ')+`</li>`; }
        proto += '<ul>';
        proto += testSteps('Back Squat',[60,70,80,85,90,95,100]);
        proto += testSteps('Dumbbell Bench Press',[60,70,80,85,90,95]); // anchored to BP 1RM
        proto += testSteps('Deadlift',[60,70,80,85,90,95,100]);
        proto += testSteps('Clean',[60,70,75,80,85,90,95]);
        proto += '</ul>';
        proto += '<div class="small">Warm up gradually. Stop if technique breaks. Treat Clean as a technical max — quality over load.</div>';
        out = proto;
      }

      document.getElementById('dailyOut').innerHTML = out;
    }

    function renderWeekly(){
      const w = parseInt(document.getElementById('weekSelectWeekly').value);
      const block = blockForWeek(w);
      const toLb = document.getElementById('lbWeekly').checked || document.getElementById('lb').checked;
      const seasoned = document.getElementById('seasonedWeekly').checked;

      // 1RMs
      let sq = parseFloat(document.getElementById('sq').value||0);
      let bp = parseFloat(document.getElementById('bp').value||0);
      let dl = parseFloat(document.getElementById('dl').value||0);
      let cln= parseFloat(document.getElementById('cln').value||0);
      const useTM = document.getElementById('useTM').checked;
      if(useTM){ sq*=0.9; bp*=0.9; dl*=0.9; cln*=0.9; }
      const oneRMs = {SQ:sq, BP:bp, DL:dl, CLN:cln};

      const blurb = block==='deload5' ? 'Deload Week — reduce accessory volume ~40–50%.' :
                     block==='deload10'? 'Deload + AMRAPs @70% to estimate e1RM.' :
                     block==='test15' ? 'Testing Week — spread lifts/tests; keep volume minimal.' :
                     (block===1?'Block 1: Base & Hypertrophy': block===2?'Block 2: Intensification':'Block 3: Peak Power/Strength');
      document.getElementById('weeklyMeta').innerHTML = `<b>Week ${w}</b> — ${blurb}`;

      const rows = [
        {day:'Lower A', main:'Back Squat', key:'Jumps/Accel + RDL/Split Squat', lift:'SQ'},
        {day:'Upper A', main:'Dumbbell Bench Press', key:'MB Chest Pass + Row/Triceps + Ring Dips', lift:'BP'},
        {day:'Lower B', main:'Deadlift', key:'MB Scoop Toss + Front/Hack + Carries', lift:'DL'},
        {day:'Upper B', main:'Clean', key:'Jerk Primer + OHP + Pull-ups + Gymnastics', lift:'CLN'}
      ];
      let htmlTbl = `<table><thead><tr><th>Day</th><th>Main Lift</th><th>Key Add‑Ons</th><th></th></tr></thead><tbody>`;
      rows.forEach((r,i)=>{
        const liftPlan = plan[r.lift][w-1];
        const det = setLines(r.lift, liftPlan, oneRMs, toLb);
        const detailId = `detail_${i}`;
        htmlTbl += `<tr><td>${r.day}</td><td>${r.main}</td><td>${r.key}</td>
          <td><button class="btn secondary" onclick="const d=document.getElementById('${detailId}'); d.style.display=d.style.display==='none'?'block':'none';">Details</button></td></tr>`;
        htmlTbl += `<tr id="${detailId}" style="display:none"><td colspan="4">
          <b>Warm-up:</b> <ul>`+det.warmLines.map(x=>`<li>${x}</li>`).join('')+`</ul>
          <b>Work:</b> <ul>`+det.workLines.map(x=>`<li>${x}</li>`).join('')+`</ul>
        </td></tr>`;
      });
      htmlTbl += `</tbody></table>`;
      document.getElementById('weeklyOut').innerHTML = htmlTbl;
    }

    // Calc table
    function showCalcTable(){
      const toLb = document.getElementById('lb').checked;
      let sq = parseFloat(document.getElementById('sq').value||0);
      let bp = parseFloat(document.getElementById('bp').value||0);
      let dl = parseFloat(document.getElementById('dl').value||0);
      let cln= parseFloat(document.getElementById('cln').value||0);
      const useTM = document.getElementById('useTM').checked;
      if(useTM){ sq*=0.9; bp*=0.9; dl*=0.9; cln*=0.9; }
      const oneRMs = {SQ:sq, BP:bp, DL:dl, CLN:cln};

      let html = `<table><thead><tr><th>Week</th>`;
      lifts.forEach(L => html += `<th>${names[L]}</th>`);
      html += `</tr></thead><tbody>`;
      for(let i=0;i<15;i++){
        html += `<tr><td>${i+1}</td>`;
        lifts.forEach(L=>{
          const item = plan[L][i];
          if(!item.p || item.p.length===0){
            html += `<td><span class="mono">${item.s}</span></td>`;
          } else {
            const loads = item.p.map(p => {
              const kg = (oneRMs[L]||0) * p/100;
              const base = roundLoad(kg, toLb);
              return `${fmt(base, toLb)}${toLb?' lb':' kg'} @${p}%`;
            });
            html += `<td><div class="mono">${item.s}</div><div class="small">${loads.join(" · ")}</div></td>`;
          }
        });
        html += `</tr>`;
      }
      html += `</tbody></table>`;
      document.getElementById('tableWrap').innerHTML = html;
    }

    // Save/load
    function saveVals(){
      const data = {
        sq: document.getElementById('sq').value,
        bp: document.getElementById('bp').value,
        dl: document.getElementById('dl').value,
        cln: document.getElementById('cln').value,
        lb: document.getElementById('lb').checked,
        useTM: document.getElementById('useTM').checked
      };
      localStorage.setItem('planVals', JSON.stringify(data));
      document.getElementById('status').textContent = 'Saved';
    }
    function loadVals(){
      const raw = localStorage.getItem('planVals'); if(!raw) return;
      try{
        const d = JSON.parse(raw);
        if(d.sq) document.getElementById('sq').value = d.sq;
        if(d.bp) document.getElementById('bp').value = d.bp;
        if(d.dl) document.getElementById('dl').value = d.dl;
        if(d.cln) document.getElementById('cln').value = d.cln;
        if(typeof d.lb==='boolean') document.getElementById('lb').checked = d.lb;
        if(typeof d.useTM==='boolean') document.getElementById('useTM').checked = d.useTM;
        document.getElementById('status').textContent = 'Loaded';
      }catch(e){}
    }

    // Events
    document.querySelectorAll('.tab').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
        document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById(btn.dataset.tab).classList.add('active');
      });
    });
    document.getElementById('calcBtn').addEventListener('click', showCalcTable);
    document.getElementById('saveBtn').addEventListener('click', saveVals);
    document.getElementById('quickCalc').addEventListener('click', ()=>{
      if(!document.getElementById('sq').value){ document.getElementById('sq').value = 180; }
      if(!document.getElementById('bp').value){ document.getElementById('bp').value = 120; }
      if(!document.getElementById('dl').value){ document.getElementById('dl').value = 220; }
      if(!document.getElementById('cln').value){ document.getElementById('cln').value = 110; }
      showCalcTable();
      renderDaily();
      renderWeekly();
    });

    // Sync Daily/Weekly toggles
    ['sq','bp','dl','cln'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('input', ()=>{ showCalcTable(); renderDaily(); renderWeekly(); });
      el.addEventListener('change', ()=>{ showCalcTable(); renderDaily(); renderWeekly(); });
    });
    ['useTM','lb'].forEach(id => {
      const el = document.getElementById(id);
      el.addEventListener('change', ()=>{ showCalcTable(); renderDaily(); renderWeekly(); });
    });
    document.getElementById('lbDaily').addEventListener('change', ()=>{
      document.getElementById('lbWeekly').checked = document.getElementById('lbDaily').checked;
      renderWeekly();
    });
    document.getElementById('lbWeekly').addEventListener('change', ()=>{
      document.getElementById('lbDaily').checked = document.getElementById('lbWeekly').checked;
      renderDaily();
    });
    document.getElementById('seasonedDaily').addEventListener('change', ()=>{
      document.getElementById('seasonedWeekly').checked = document.getElementById('seasonedDaily').checked;
      renderWeekly();
    });
    document.getElementById('seasonedWeekly').addEventListener('change', ()=>{
      document.getElementById('seasonedDaily').checked = document.getElementById('seasonedWeekly').checked;
      renderDaily();
    });

    // Initialize
    if('serviceWorker' in navigator){ window.addEventListener('load', ()=> navigator.serviceWorker.register('./service-worker.js')); }
    // Populate week selects
    showCalcTable();
    renderDaily();
    renderWeekly();
  </script>
</body>
</html>
